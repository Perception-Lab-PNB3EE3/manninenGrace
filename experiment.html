<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/plugin-html-button-response.js"></script>
    <script src="jspsych/plugin-image-keyboard-response.js"></script>
    <script src="jspsych/plugin-image-button-response.js"></script>
    <script src="AVOKE/plugin-audio-visual-response/index.js"></script>
    <script src="jspsych/plugin-survey-likert.js"></script>
    <script src="jspsych/plugin-preload.js"></script>
    <script src="jatos.js"></script>
    
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />
  
  </head>
  <body></body>
  <script>

const timeline = [];
    
// Initializing JsPsych
    const jsPsych = initJsPsych({
      on_trial_start = jatos.addAbortButton,
      on_finish: () => jatos.startNextComponent(jsPsych.data.get().json()),
      function() {
        jsPsych.data.displayData();
      }
    });    

// Randomizing what condition someone will first go into; music (1) or no music (2)
    const first_condition= jsPsych.randomization.shuffle(["music","no music"])[0]
    console.log("First condition Will Be", first_condition)

// Preloading images and music
    var preload = {
      type: jsPsychPreload,
      images: [
        "images/amphibian1.png", "images/amphibian3.png", "images/amphibian4.png",
        "images/arachnid1.png", "images/arachnid3.png", "images/bivalve1.png", "images/fish15.png",
        "images/insect2.png", "images/insect3.png", "images/insect8.png", "images/insect13.png",
        "images/mammal13.png", "images/mammal14.png", "images/mammal16.png", "images/mammal17.png", 
        "images/mammal19.png", "images/mammal23.png", "images/mammal25.png", "images/mammal31.png", 
        "images/mammal35.png", "images/mammal34.png"
      ],
      audio: ["audio/music.m4a", "audio/silence.m4a"]
    };
   
//   Dividing up images between favoured and unfavoured
    var favouredimages = jsPsych.randomization.shuffle ([
      "images/mammal17.png",
      "images/mammal31.png",
      "images/mammal23.png",
      "images/mammal16.png",
      "images/mammal19.png",
      "images/mammal13.png",
      "images/mammal14.png",
      "images/mammal25.png",
      "images/fish15.png",
      "images/mammal35.png" 
    ]);
    
    var unfavouredimages = jsPsych.randomization.shuffle([
      "images/amphibian1.png",
      "images/amphibian3.png",
      "images/amphibian4.png",
      "images/arachnid1.png",
      "images/arachnid3.png",
      "images/bivalve1.png",
      "images/insect2.png",
      "images/insect3.png",
      "images/insect8.png",
      "images/insect13.png"
    ]);
    
// Shuffling images
    var favouredimages_shuffled = jsPsych.randomization.shuffle(favouredimages)
    var unfavouredimages_shuffled = jsPsych.randomization.shuffle(unfavouredimages)

//Assign the shuffled list of images to music condition or no music condition
    var fav_music = favouredimages_shuffled.slice(0,5);
    var fav_nomusic = favouredimages_shuffled.slice(5);
    
    var unfav_music = unfavouredimages_shuffled.slice(0,5);
    var unfav_nomusic= unfavouredimages_shuffled.slice(5);
    
    // Combine 5 favoured + 5 unfavoured images for a condition
    var music_image_list = jsPsych.randomization.shuffle(fav_music.concat(unfav_music));
    var nomusic_image_list = jsPsych.randomization.shuffle(fav_nomusic.concat(unfav_nomusic))
    
    //trials
    
    const welcomemessage = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: 'Welcome to the experiment! Press any key to begin'
      };

    var instructions = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
      <p>This experiment will take around 10-15 minutes.</p>
      <p>In this experiment, you will view multiple animals and will be asked to answer one Likert-Scale question for each animal.</p>
      <p>This study is voluntary, and you can withdraw without penalty at any time. 
      Please answer every question honestly, and engage fully with the study.</p>
      <p> If you have specific phobias of animals, please withdraw from the study and take care of your mental health.</p>
      <p>You will need a stable internet connection and enough battery to run the experiment. 
      Please take this time to plug your computer into an outlet and ensure you have a stable internet connection.</p>
      <p>You will also need headphones that can connect to your computer.</p>
      <p>You need to be able to hear audio and view images.</p>
      <p>Press any key to begin.</p>
      `,
      };
      
    var consent = {
      type: jsPsychHtmlButtonResponse,
      stimulus: `
      <p>Data collected: Likert Scale Responses & Button Responses.</p>
      <p>The experimenter will have access to this data.</p>
      <p>Your data will not be sold or used for any purpose other than this experiment.</p>
      <p>The risks of this study are that those with specific phobias to animals may 
      find some of the stimuli triggering/upsetting.</p>
      `,
      choices: ['I agree'],
      prompt: "<p>Click I Agree if you consent</p>",
      };
    
        
    var test_image = {
      type: jsPsychImageButtonResponse,
      stimulus: "images/mammal34.png",
      choices: ['Seal', 'Polarbear'],
      prompt: "<p>What Animal is being displayed?</p>"
      };
    
    function createMusicImageTrial(imagePath) {
    return {
      type: jsPsychAudioVisualResponse,
      image_stimulus: imagePath,   // current image
      audio_stimulus: "audio/music.m4a", // music for this condition
      choices: ["Next"],
      button_activate_time: 1000,
      data: {
        image: imagePath,
        music: true
      }      
      }
      };
      
    function createNoMusicImageTrial(imagePath) {
    return {
      type: jsPsychAudioVisualResponse,
      image_stimulus: imagePath,
      audio_stimulus: "audio/silence.m4a",
      choices: ["Next"],
      button_activate_time: 1000,
      data: {
      image: imagePath,
      music: false
      }
      };
      }
      
    function createLikertTrial() {
    return {
      type: jsPsychSurveyLikert,
      questions: [{
        prompt: "I would want to care for or protect this species.",
        labels: [
          "Strongly disagree","Disagree","Somewhat disagree",
          "Neither agree nor disagree","Somewhat agree","Agree","Strongly agree"
        ],
        required: true
      }]
      };
      };
      
    
  ///Experiment Start

timeline.push(preload);
timeline.push(welcomemessage);
timeline.push(instructions);
timeline.push(consent);
timeline.push(test_image)
    

if (first_condition == "music") {

  music_image_list.forEach(function(currentImage) {
    timeline.push(createMusicImageTrial(currentImage));
    timeline.push(createLikertTrial());
  });

  nomusic_image_list.forEach(function(currentImage) {
    timeline.push(createNoMusicImageTrial(currentImage));
    timeline.push(createLikertTrial());
  });

} else {

  nomusic_image_list.forEach(function(currentImage) {
    timeline.push(createNoMusicImageTrial(currentImage));
    timeline.push(createLikertTrial());
  });

  music_image_list.forEach(function(currentImage) {
    timeline.push(createMusicImageTrial(currentImage));
    timeline.push(createLikertTrial());
  });

}


 jatos.onLoad (() => {
   jsPsych.run(timeline);
 });  
    
  </script>
</html>